<h4 class="ui header">WHO Coronavirus (COVID-19) Dashboard</h4>

<%= render "form" %>
<div class="ui divider"></div>

<div class="ui grid">
  <div class="sixteen wide column">
    <div class="ui segment">
      <%= render "filter", countryObj: @countries, vaccineObj: @vaccines %>
    </div>
  </div>
</div>

<table class="ui striped table">
  <thead>
    <tr>
      <th>#</th>
      <th>Country</th>
      <th>ISO3</th>
      <th>Data Source</th>
      <th>Date Updated</th>
      <th class="right aligned">Total Vaccinations</th>
      <th class="right aligned">Persons Vaccinated 1Plus Dose</th>
      <th class="right aligned">Total Vaccinations Per 100</th>
      <th>Vaccines Used</th>
      <th>First Vaccine Date</th>
      <th class="center aligned">Number of Vaccine Type Used</th>
    </tr>
  </thead>
  <tbody>
    <% @vaccinations.each_with_index do |data, index| %>
      <tr>
        <td data-label="No"><%= index + 1 %></td>
        <td data-label="Country"><%= data.country.try(&:country) %></td>
        <td data-label="ISO3"><%= data.country.try(&:iso3) %></td>
        <td data-label="Data Source"><%= data.vaccines.first.try(&:data_source).try(&:upcase) %></td>
        <td data-label="Date Updated"><%= data.date_updated %></td>
        <td data-label="Total Vaccinations" class="right aligned"><%= number_with_delimiter(data.total_vaccinations) %></td>
        <td data-label="Persons Vaccinated 1Plus Dose" class="right aligned"><%= number_with_delimiter(data.persons_vaccinated_1plus_dose) %></td>
        <td data-label="Total Vaccinations Per 100" class="right aligned"><%= number_with_delimiter(data.total_vaccinations_per100) %></td>
        <td data-label="Vaccines Used">
          <%= data.vaccines.map{ |vaccine| vaccine.vaccine_name }.join(", ") %>
        </td>
        <td data-label="First Vaccine Date"><%= data.first_vaccine_date %></td>
        <td data-label="Number of Vaccine Type Used" class="center aligned"><%= data.vaccination_details.count %></td>
      </tr>
    <% end %>
  </tbody>
</table>